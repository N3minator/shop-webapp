import logging
import sys
from telegram.ext import Application
from core.config import TOKEN
from utils.setup_jobqueue import setup_jobqueue  # –∑–∞–≥–ª—É—à–∫–∞ –∏–ª–∏ —Ä–µ–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
from core.setup_handlers import setup_all_handlers  # –≤—Å—ë –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –∑–¥–µ—Å—å
from utils.users import init_db

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ–¥–Ω—è—Ç—å —É—Ä–æ–≤–µ–Ω—å INFO –¥–ª—è webapp_handler)
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s ‚Äî %(name)s ‚Äî %(levelname)s ‚Äî %(message)s",
    handlers=[logging.StreamHandler(sys.stdout)]
)

logging.getLogger("telegram.ext").setLevel(logging.INFO)
logging.getLogger("telegram.bot").setLevel(logging.INFO)
# –¢–µ–ø–µ—Ä—å INFO-–ª–æ–≥–∏ –∏–∑ –º–æ–¥—É–ª—è handle_web_app_data –±—É–¥—É—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è
logging.getLogger('core.webapp.webapp_handler').setLevel(logging.INFO)


# üöÄ post_init: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—á–µ—Ä–µ–¥—å –∏ –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
async def post_init(app):
    init_db()
    await setup_jobqueue(app)


def main():
    app = Application.builder().token(TOKEN).post_init(post_init).build()
    setup_all_handlers(app)
    app.run_polling()


if __name__ == '__main__':
    main()

"""
üöÄ –ó–∞–ø—É—Å–∫ Telegram-–±–æ—Ç–∞: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ü–æ—è—Å–Ω–µ–Ω–∏–µ
==============================================

üìå –≠—Ç–æ—Ç —Ñ–∞–π–ª `main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ Telegram-–±–æ—Ç–∞. –û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Telegram Application
- –ù–∞—Å—Ç—Ä–æ–π–∫—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ (–∫–æ–º–∞–Ω–¥, callback-–∫–Ω–æ–ø–æ–∫, —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ç.–¥.)
- –û–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JobQueue (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤ –±—É–¥—É—â–µ–º –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á)

üß© –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –∑–∞–ø—É—Å–∫–∞:
--------------------------
1. üîê –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –∏–∑ `utils/config.py`, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ `.env`.
2. üß± –°–æ–∑–¥–∞—ë—Ç—Å—è Telegram-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é:
       `Application.builder().token(TOKEN).post_init(post_init).build()`
   - `post_init` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç `JobQueue` –∏ `on_bot_start`).
3. üîå –í `setup_handlers.py` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ (–ø–æ –≥—Ä—É–ø–ø–∞–º, —Ä–æ–ª—è–º, –õ–° –∏ —Ç.–¥.)
4. üì¨ –í–∫–ª—é—á–∞–µ—Ç—Å—è —Ä–µ–∂–∏–º `run_polling()` ‚Äî –±–æ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–ª—É—à–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.

üìÇ –ú–æ–¥—É–ª–∏, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ –∑–∞–ø—É—Å–∫–µ:
---------------------------------
- `main.py`                ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª, —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞.
- `utils/config.py`        ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
- `setup_handlers.py`      ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã, callback'–∏ –∏ ConversationHandler.
- `setup_jobqueue.py`      ‚Äî –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è JobQueue (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π).
- `handlers/...`           ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ –≤—Å–µ–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ (–∫–æ–º–∞–Ω–¥—ã, callback, —É—Ç–∏–ª–∏—Ç—ã, –∏–≥—Ä—ã, —Ä–æ–ª–∏).
- `creator_bot/restart_bot.py` ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–º–∞–Ω–¥—ã `!restart` –∏ –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.
"""